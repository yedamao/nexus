# WebSocket API Specification

## Connection

*   **URL:** `ws://<server_host>:<port>/ws`
*   **Protocol:** JSON over WebSocket

## Message Structure

All messages exchanged between the client and server must be valid JSON objects with the following base structure:

```json
{
  "type": "string",  // Event type
  "payload": { ... } // Data specific to the event
}
```

---

## Client -> Server Messages

### 1. Send Message
Sent when a user attempts to broadcast a text message to the chat room.

*   **Type:** `send_message`
*   **Payload:**
    *   `username` (string): The sender's display name.
    *   `content` (string): The text content of the message.

**Example:**
```json
{
  "type": "send_message",
  "payload": {
    "username": "Alice",
    "content": "Hello everyone!"
  }
}
```

### 2. User Join (Optional Handshake)
Sent immediately after connection to register the user's identity.

*   **Type:** `join`
*   **Payload:**
    *   `username` (string): The display name of the user joining.

**Example:**
```json
{
  "type": "join",
  "payload": {
    "username": "Alice"
  }
}
```

---

## Server -> Client Messages

### 1. Broadcast Message
Received when another user (or the sender) posts a message.

*   **Type:** `broadcast_message`
*   **Payload:**
    *   `username` (string): The sender's display name.
    *   `content` (string): The message content.
    *   `timestamp` (string): ISO 8601 timestamp (generated by server).

**Example:**
```json
{
  "type": "broadcast_message",
  "payload": {
    "username": "Alice",
    "content": "Hello everyone!",
    "timestamp": "2023-10-27T10:00:00Z"
  }
}
```

### 2. User Notification (System)
Received when a user joins or leaves the chat.

*   **Type:** `system_notification`
*   **Payload:**
    *   `content` (string): The system message (e.g., "Alice has joined the chat").
    *   `timestamp` (string): ISO 8601 timestamp.

**Example:**
```json
{
  "type": "system_notification",
  "payload": {
    "content": "Alice has joined the chat",
    "timestamp": "2023-10-27T10:00:05Z"
  }
}
```

### 3. User List Update (Optional)
Sent to update the client's list of currently active users.

*   **Type:** `user_list`
*   **Payload:**
    *   `users` (array of strings): List of active usernames.

**Example:**
```json
{
  "type": "user_list",
  "payload": {
    "users": ["Alice", "Bob", "Charlie"]
  }
}
```
